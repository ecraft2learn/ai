<project name="speak and listen then puzzle 2" app="Snap! 4.0, http://snap.berkeley.edu" version="1"><notes></notes><thumbnail>data:image/png;base64,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</thumbnail><stage name="Stage" width="480" height="360" costume="0" tempo="60" threadsafe="false" lines="round" codify="false" inheritance="false" sublistIDs="false" scheduled="false" id="1"><pentrails>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAFoCAYAAACPNyggAAAOhUlEQVR4Xu3VwQkAAAjEMN1/abewn7jAQRC64wgQIECAAIF3gX1fNEiAAAECBAiMAHsCAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQIHLFxAWmhEwHPAAAAAElFTkSuQmCC</pentrails><costumes><list id="2"></list></costumes><sounds><list id="3"></list></sounds><variables></variables><blocks></blocks><scripts></scripts><sprites><sprite name="Sprite" idx="1" x="0" y="0" heading="90" scale="1" rotation="1" draggable="true" costume="0" color="80,80,80" pen="tip" id="8"><costumes><list id="9"></list></costumes><sounds><list id="10"></list></sounds><variables></variables><blocks></blocks><scripts><script x="21" y="18"><block s="receiveGo"></block><custom-block s="speak %s then %cmdRing in language %s with pitch %n with rate %n with voice %n with volume %n"><l>Say something</l><block s="reifyScript"><script><custom-block s="listen"></custom-block></script><list></list></block><l></l><l></l><l></l><l></l><l></l></custom-block></script><script x="23" y="110"><block s="receiveMessage"><l>heard something</l></block></script><script x="21" y="163"><block s="reportEquals"><l></l><l></l></block></script><script x="93" y="164"><block var="last thing spoken"/></script><script x="23" y="194"><block s="doIf"><l/><script></script></block></script><script x="91" y="200"><block s="turn"><l>15</l></block></script><script x="270" y="130"><custom-block s="save project %txt"><l>speak and listen</l></custom-block></script><script x="270" y="180"><custom-block s="open project %txt"><l>speak and listen</l></custom-block></script></scripts></sprite><watcher var="last thing spoken" style="normal" x="10" y="10" color="243,118,29"/><watcher var="listening" style="normal" x="10" y="31.000001999999995" color="243,118,29" hidden="true"/></sprites></stage><hidden></hidden><headers></headers><code></code><blocks><block-definition s="speak %&apos;text&apos; %&apos;what to do when finished&apos;" type="command" category="sound"><header></header><code></code><inputs><input type="%s"></input><input type="%cmdRing"></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>message</l><l>finished_callback</l></list><l>var utterance = new SpeechSynthesisUtterance(message);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;if (typeof finished_callback === &apos;object&apos;) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;   // callback provided&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;   utterance.onend = function (event) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;       invoke(finished_callback, new List([message]));&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;   };&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;}&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;if (window.speech_recognition) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;   window.speech_recognition.abort();&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;}&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;window.speechSynthesis.speak(utterance);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;</l></block><list><block var="text"/><block var="what to do when finished"/></list></block></script></block-definition><block-definition s="listen and then %&apos;do with recognised words&apos; %&apos;do if nothing recognised&apos;" type="command" category="other"><header></header><code></code><inputs><input type="%cmdRing"></input><input type="%cmdRing"></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>spoken_callback</l><l>error_callback</l></list><l>var restart = function () {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    if (window.speechSynthesis.speaking) { // don&apos;t listen while speaking&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        // there remains the possibility of speech happening after recognition starts&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        setTimeout(restart, 500); // try again in half a second&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        return;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    }&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    try {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        window.speech_recognition.start();&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        console.log("recognition started");&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    } catch (error) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        if (error.name === &apos;InvalidStateError&apos;) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;            // delay needed at least in Chrome 52&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;            setTimeout(restart, 2000);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        } else {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;            console.log(error);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        }&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    }&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;};&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;var handle_result = function (callback, event) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    var spoken = event.results[0][0].transcript;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    console.log("Confidence is " + event.results[0][0].confidence + " for " + spoken, spoken_callback);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    window.speech_recognition.stop();&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    invoke(callback, new List([spoken]));&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;};&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;var handle_error = function (callback, event) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    if (event.error === &apos;aborted&apos;) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        console.log("aborted so restarting speech recognition in half a second");&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        setTimeout(restart, 500);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        return;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    }&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    if (event.error === &apos;no-speech&apos;) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        window.speech_recognition.onend = null;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        window.speech_recognition.onresult = null;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        window.speech_recognition.stop();&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    }&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    console.log("Recognition error: " + event.error);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    if (typeof callback === &apos;object&apos;) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        invoke(callback, new List([event.error]));&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    }&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;};&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;if (!window.speech_recognition) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    window.speech_recognition = (typeof SpeechRecognition === &apos;undefined&apos;) ? &#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        new webkitSpeechRecognition() :&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;        new SpeechRecognition();&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;}&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;window.speech_recognition.onresult = function (event) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    handle_result(spoken_callback, event);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;};&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;window.speech_recognition.onerror = function (event) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    handle_error(error_callback, event);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;};&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;window.speech_recognition.onend = function (event) {&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    console.log("recognition ended");&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;    restart(); &#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;};&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;restart();&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;</l></block><list><block var="do with recognised words"/><block var="do if nothing recognised"/></list></block></script></block-definition><block-definition s="listen" type="command" category="other"><header></header><code></code><inputs></inputs><script><custom-block s="Turn off unloading warnings"></custom-block><block s="doSetVar"><l>listening</l><block s="reportBoolean"><l><bool>true</bool></l></block></block><custom-block s="listen and then %cmdRing %cmdRing"><block s="reifyScript"><script><block s="doSetVar"><l>last thing spoken</l><block var="spoken"/></block><block s="doBroadcast"><l>heard something</l></block><custom-block s="listen"></custom-block></script><list><l>spoken</l></list></block><block s="reifyScript"><script><block s="doSetVar"><l>speech recognition error</l><block var="error"/></block><block s="doBroadcast"><l>speech recognition error</l></block><block s="doIf"><block var="listening"/><script><block s="doIfElse"><block s="reportEquals"><block var="speech recognition error"/><l>no-speech</l></block><script><custom-block s="speak %s %cmdRing"><l>I didn&apos;t hear anything for a while. Bye.</l><block s="reifyScript"><script></script><list></list></block></custom-block><block s="doSetVar"><l>listening</l><block s="reportBoolean"><l><bool>false</bool></l></block></block></script><script><custom-block s="speak %s %cmdRing"><block s="reportJoinWords"><list><l>There was an error. </l><block var="speech recognition error"/></list></block><block s="reifyScript"><script></script><list></list></block></custom-block><block s="bubble"><block s="reportJoinWords"><list><l>There was an error. </l><block var="speech recognition error"/></list></block></block><custom-block s="speak %s %cmdRing"><l>Try again.</l><block s="reifyScript"><script><custom-block s="listen"></custom-block></script><list></list></block></custom-block></script></block></script></block></script><list><l>error</l></list></block></custom-block></script></block-definition><block-definition s="Turn off unloading warnings" type="command" category="other"><header></header><code></code><inputs></inputs><script><block s="doRun"><block s="reportJSFunction"><list></list><l>window.onbeforeunload = null;</l></block><list></list></block></script></block-definition><block-definition s="speak %&apos;text&apos; then %&apos;what to do when finished&apos; in language %&apos;language code&apos; with pitch %&apos;pitch&apos; with rate %&apos;rate&apos; with voice %&apos;voice&apos; with volume %&apos;volume&apos;" type="command" category="sound"><header></header><code></code><inputs><input type="%s"></input><input type="%cmdRing"></input><input type="%s"></input><input type="%n"></input><input type="%n"></input><input type="%n"></input><input type="%n"></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>message</l><l>finished_callback</l><l>lang</l><l>pitch</l><l>rate</l><l>voice</l><l>volume</l></list><l>// see https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance&#xD;var utterance = new SpeechSynthesisUtterance(message);&#xD;if (lang) {&#xD;   utterance.lang = lang;&#xD;}&#xD;if (pitch &gt; 0) {&#xD;   utterance.pitch = pitch;&#xD;}&#xD;if (rate &gt; 0) {&#xD;   if (rate &lt; .1) {&#xD;      // A very slow rate breaks Chrome&apos;s speech synthesiser&#xD;      rate = .1;&#xD;   }&#xD;   if (rate &gt; 2) {&#xD;      rate = 2; // high rate also breaks Chrome&apos;s speech synthesis&#xD;   }&#xD;   utterance.rate = rate;&#xD;}&#xD;if (voice) {&#xD;   voices = window.speechSynthesis.getVoices();&#xD;   if (voice &gt;= 0 &amp;&amp; voice &lt; voices.length) {&#xD;       utterance.voice = voices[Math.floor(voice)];&#xD;   } else {&#xD;       alert("Only " + voices.length + " voices are available. You can&apos;t choose voice number " + voice);&#xD;   }&#xD;}&#xD;if (volume &gt; 0) {&#xD;   utterance.volume = volume;&#xD;}&#xD;if (typeof finished_callback === &apos;object&apos;) {&#xD;   // callback provided&#xD;   utterance.onend = function (event) {&#xD;       invoke(finished_callback, new List([message]));&#xD;   };&#xD;}&#xD;if (window.speech_recognition) {&#xD;   window.speech_recognition.abort();&#xD;}&#xD;window.speechSynthesis.speak(utterance);&#xD;</l></block><list><block var="text"/><block var="what to do when finished"/><block var="language code"/><block var="pitch"/><block var="rate"/><block var="voice"/><block var="volume"/></list></block></script></block-definition><block-definition s="save project %&apos;project name&apos;" type="command" category="other"><header></header><code></code><inputs><input type="%txt"></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>name</l></list><l>var get_ide = function () {&#xD;&#xD;&#xD;    var ancestor = this;&#xD;&#xD;&#xD;    var value;&#xD;&#xD;&#xD;    while (ancestor &amp;&amp; !(ancestor instanceof IDE_Morph)) {&#xD;&#xD;&#xD;        ancestor = ancestor.parent;&#xD;&#xD;&#xD;    }&#xD;&#xD;&#xD;    if (ancestor) {&#xD;&#xD;&#xD;        return ancestor;&#xD;&#xD;&#xD;    } else {&#xD;&#xD;&#xD;        return world.children[0];&#xD;&#xD;&#xD;    }&#xD;&#xD;&#xD;}.bind(this);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;get_ide().saveProject(name);</l></block><list><block var="project name"/></list></block></script></block-definition><block-definition s="open project %&apos;project name&apos;" type="command" category="other"><header></header><code></code><inputs><input type="%txt"></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>name</l></list><l>var get_ide = function () {&#xD;&#xD;&#xD;    var ancestor = this;&#xD;&#xD;&#xD;    var value;&#xD;&#xD;&#xD;    while (ancestor &amp;&amp; !(ancestor instanceof IDE_Morph)) {&#xD;&#xD;&#xD;        ancestor = ancestor.parent;&#xD;&#xD;&#xD;    }&#xD;&#xD;&#xD;    if (ancestor) {&#xD;&#xD;&#xD;        return ancestor;&#xD;&#xD;&#xD;    } else {&#xD;&#xD;&#xD;        return world.children[0];&#xD;&#xD;&#xD;    }&#xD;&#xD;&#xD;}.bind(this);&#xD;&#xD;&#xD;&#xD;&#xD;&#xD;get_ide().openProject(name);&#xD;&#xD;&#xD;</l></block><list><block var="project name"/></list></block></script></block-definition></blocks><variables><variable name="last thing spoken"><l>okay what do you want to hear</l></variable><variable name="listening"><bool>true</bool></variable></variables></project>