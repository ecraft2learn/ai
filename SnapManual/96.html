<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p96" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_96{left:459px;bottom:27px;letter-spacing:0.11px;}
#t2_96{left:66px;bottom:1129px;letter-spacing:0.13px;}
#t3_96{left:55px;bottom:846px;letter-spacing:0.13px;}
#t4_96{left:55px;bottom:822px;letter-spacing:0.12px;}
#t5_96{left:495px;bottom:822px;letter-spacing:0.13px;}
#t6_96{left:660px;bottom:822px;letter-spacing:0.13px;}
#t7_96{left:55px;bottom:798px;letter-spacing:0.13px;}
#t8_96{left:692px;bottom:798px;letter-spacing:0.11px;}
#t9_96{left:55px;bottom:774px;letter-spacing:0.12px;}
#ta_96{left:109px;bottom:774px;letter-spacing:0.12px;}
#tb_96{left:466px;bottom:774px;letter-spacing:0.12px;}
#tc_96{left:55px;bottom:750px;letter-spacing:0.13px;}
#td_96{left:55px;bottom:726px;letter-spacing:0.13px;}
#te_96{left:55px;bottom:701px;letter-spacing:0.13px;}
#tf_96{left:55px;bottom:677px;letter-spacing:0.13px;}
#tg_96{left:55px;bottom:653px;letter-spacing:0.12px;}
#th_96{left:303px;bottom:653px;letter-spacing:0.13px;}
#ti_96{left:602px;bottom:653px;letter-spacing:0.17px;}
#tj_96{left:634px;bottom:653px;letter-spacing:0.13px;}
#tk_96{left:55px;bottom:628px;letter-spacing:0.13px;}
#tl_96{left:533px;bottom:628px;letter-spacing:0.13px;}
#tm_96{left:602px;bottom:628px;letter-spacing:0.1px;}
#tn_96{left:681px;bottom:628px;letter-spacing:0.13px;}
#to_96{left:55px;bottom:602px;letter-spacing:0.13px;}
#tp_96{left:417px;bottom:602px;letter-spacing:0.17px;}
#tq_96{left:449px;bottom:602px;letter-spacing:0.13px;}
#tr_96{left:666px;bottom:602px;letter-spacing:0.14px;}
#ts_96{left:55px;bottom:576px;}
#tt_96{left:68px;bottom:576px;letter-spacing:0.16px;}
#tu_96{left:100px;bottom:576px;letter-spacing:0.14px;}
#tv_96{left:430px;bottom:576px;}
#tw_96{left:443px;bottom:576px;letter-spacing:0.17px;}
#tx_96{left:461px;bottom:584px;letter-spacing:0.11px;}
#ty_96{left:479px;bottom:576px;letter-spacing:0.13px;}
#tz_96{left:66px;bottom:424px;letter-spacing:0.13px;}
#t10_96{left:380px;bottom:424px;letter-spacing:0.13px;}
#t11_96{left:515px;bottom:424px;letter-spacing:0.17px;}
#t12_96{left:543px;bottom:424px;letter-spacing:0.12px;}
#t13_96{left:55px;bottom:398px;letter-spacing:0.12px;}
#t14_96{left:648px;bottom:398px;letter-spacing:0.12px;}
#t15_96{left:800px;bottom:398px;letter-spacing:0.13px;}
#t16_96{left:55px;bottom:373px;letter-spacing:0.12px;}
#t17_96{left:204px;bottom:373px;letter-spacing:0.12px;}
#t18_96{left:429px;bottom:373px;letter-spacing:0.13px;}
#t19_96{left:498px;bottom:373px;letter-spacing:0.12px;}
#t1a_96{left:55px;bottom:347px;letter-spacing:0.13px;}
#t1b_96{left:193px;bottom:347px;letter-spacing:0.13px;}
#t1c_96{left:263px;bottom:347px;letter-spacing:0.1px;}
#t1d_96{left:301px;bottom:347px;letter-spacing:0.12px;}
#t1e_96{left:540px;bottom:347px;letter-spacing:0.12px;}
#t1f_96{left:774px;bottom:347px;letter-spacing:0.09px;}
#t1g_96{left:784px;bottom:347px;}
#t1h_96{left:798px;bottom:347px;letter-spacing:0.1px;}
#t1i_96{left:55px;bottom:321px;letter-spacing:0.1px;}
#t1j_96{left:115px;bottom:321px;letter-spacing:0.15px;}
#t1k_96{left:148px;bottom:321px;letter-spacing:0.13px;}
#t1l_96{left:481px;bottom:321px;letter-spacing:0.13px;}
#t1m_96{left:764px;bottom:321px;letter-spacing:0.12px;}
#t1n_96{left:55px;bottom:296px;letter-spacing:0.11px;}
#t1o_96{left:127px;bottom:296px;letter-spacing:0.13px;}
#t1p_96{left:192px;bottom:296px;letter-spacing:0.13px;}
#t1q_96{left:55px;bottom:270px;letter-spacing:0.13px;}
#t1r_96{left:414px;bottom:270px;letter-spacing:0.14px;}
#t1s_96{left:55px;bottom:246px;letter-spacing:0.13px;}
#t1t_96{left:66px;bottom:206px;letter-spacing:0.13px;}
#t1u_96{left:324px;bottom:206px;letter-spacing:0.14px;}
#t1v_96{left:359px;bottom:206px;letter-spacing:0.12px;}
#t1w_96{left:411px;bottom:206px;letter-spacing:0.13px;}
#t1x_96{left:55px;bottom:181px;letter-spacing:0.13px;}
#t1y_96{left:88px;bottom:181px;letter-spacing:0.11px;}
#t1z_96{left:210px;bottom:181px;letter-spacing:0.13px;}
#t20_96{left:788px;bottom:181px;letter-spacing:0.11px;}
#t21_96{left:55px;bottom:157px;letter-spacing:0.13px;}
#t22_96{left:341px;bottom:157px;letter-spacing:0.12px;}
#t23_96{left:388px;bottom:157px;letter-spacing:0.12px;}
#t24_96{left:55px;bottom:131px;letter-spacing:0.13px;}
#t25_96{left:475px;bottom:131px;letter-spacing:0.13px;}
#t26_96{left:757px;bottom:131px;letter-spacing:0.12px;}
#t27_96{left:809px;bottom:131px;letter-spacing:0.11px;}

.s1_96{font-size:18px;font-family:Baskerville_1wf;color:#000;}
.s2_96{font-size:18px;font-family:Baskerville-Italic_1wn;color:#000;}
.s3_96{font-size:18px;font-family:TektonPro-Bold_1w3;color:#000;}
.s4_96{font-size:18px;font-family:Baskerville_1yk;color:#000;}
.s5_96{font-size:12px;font-family:Baskerville_1xg;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts96" type="text/css" >

@font-face {
	font-family: Baskerville-Italic_1wn;
	src: url("fonts/Baskerville-Italic_1wn.woff") format("woff");
}

@font-face {
	font-family: Baskerville_1wf;
	src: url("fonts/Baskerville_1wf.woff") format("woff");
}

@font-face {
	font-family: Baskerville_1xg;
	src: url("fonts/Baskerville_1xg.woff") format("woff");
}

@font-face {
	font-family: Baskerville_1yk;
	src: url("fonts/Baskerville_1yk.woff") format("woff");
}

@font-face {
	font-family: TektonPro-Bold_1w3;
	src: url("fonts/TektonPro-Bold_1w3.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg96Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg96" style="-webkit-user-select: none;"><object width="935" height="1210" data="96/96.svg" type="image/svg+xml" id="pdf96" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_96" class="t s1_96">96 </span>
<span id="t2_96" class="t s1_96">The original expression can now be represented as </span>
<span id="t3_96" class="t s1_96" data-mappings='[[96,"fi"]]'>If you read this top to bottom, don’t you get “Add two and two, take the factorial of that, add ﬁve to that, </span>
<span id="t4_96" class="t s1_96">multiply three by that, and take the factorial of the result”? </span><span id="t5_96" class="t s1_96">Just what we wanted! </span><span id="t6_96" class="t s1_96">This way of working, in </span>
<span id="t7_96" class="t s1_96">which every block is a command that takes a continuation as one of its inputs, is called </span><span id="t8_96" class="t s2_96">continuation-passing style </span>
<span id="t9_96" class="t s2_96">(CPS). </span><span id="ta_96" class="t s1_96">Okay, it looks horrible, but it has subtle virtues. </span><span id="tb_96" class="t s1_96">One of them is that each script is just one block long </span>
<span id="tc_96" class="t s1_96">(with the rest of the work buried in the continuation given to that one block), so each block doesn’t have to </span>
<span id="td_96" class="t s1_96">remember what else to do—in the vocabulary of this section, the (implicit) continuation of each block is empty. </span>
<span id="te_96" class="t s1_96">Instead of the usual picture of recursion, with a bunch of little people all waiting for each other, with CPS what </span>
<span id="tf_96" class="t s1_96">happens is that each little person hands off the problem to the next one and goes to the beach, so there’s only </span>
<span id="tg_96" class="t s1_96">one active little person at a time. </span><span id="th_96" class="t s1_96">In this example, we start with Alfred, an </span><span id="ti_96" class="t s3_96">add </span><span id="tj_96" class="t s1_96">specialist, who computes the </span>
<span id="tk_96" class="t s1_96">value 4 and then hands off the rest of the problem to Francine, a </span><span id="tl_96" class="t s3_96">factorial </span><span id="tm_96" class="t s1_96">specialist. </span><span id="tn_96" class="t s1_96">She computes the value </span>
<span id="to_96" class="t s1_96">24, then hands the problem off to Anne, another </span><span id="tp_96" class="t s3_96">add </span><span id="tq_96" class="t s1_96">specialist, who computes 29. </span><span id="tr_96" class="t s1_96" data-mappings='[[17,"fi"]]'>And so on, until ﬁnally Sam, </span>
<span id="ts_96" class="t s1_96">a </span><span id="tt_96" class="t s3_96">say </span><span id="tu_96" class="t s1_96">specialist, says the value 2.107757298379527</span><span id="tv_96" class="t s4_96">×</span><span id="tw_96" class="t s1_96">10 </span>
<span id="tx_96" class="t s5_96">132 </span>
<span id="ty_96" class="t s1_96">, which is a very large number! </span>
<span id="tz_96" class="t s1_96" data-mappings='[[17,"fi"]]'>Go back to the deﬁnitions of these blocks. </span><span id="t10_96" class="t s1_96">The ones, such as </span><span id="t11_96" class="t s3_96">add</span><span id="t12_96" class="t s1_96">, that correspond to primitive reporters are </span>
<span id="t13_96" class="t s1_96">simple; they just call the reporter and then call their continuation with its result. </span><span id="t14_96" class="t s1_96" data-mappings='[[10,"fi"]]'>But the deﬁnition of </span><span id="t15_96" class="t s3_96">factorial </span>
<span id="t16_96" class="t s1_96">is more interesting. </span><span id="t17_96" class="t s1_96">It doesn’t just call our original </span><span id="t18_96" class="t s3_96">factorial </span><span id="t19_96" class="t s1_96">reporter and send the result to its continuation. </span>
<span id="t1a_96" class="t s1_96">CPS is used inside </span><span id="t1b_96" class="t s3_96">factorial </span><span id="t1c_96" class="t s1_96">too! </span><span id="t1d_96" class="t s1_96">It says, “See if my input is zero. </span><span id="t1e_96" class="t s1_96">Send the (true or false) result to </span><span id="t1f_96" class="t s3_96">if</span><span id="t1g_96" class="t s1_96">. </span><span id="t1h_96" class="t s1_96">If the </span>
<span id="t1i_96" class="t s1_96">result is </span><span id="t1j_96" class="t s3_96">true</span><span id="t1k_96" class="t s1_96">, then call my continuation with the value 1. </span><span id="t1l_96" class="t s1_96">Otherwise, subtract 1 from my input. </span><span id="t1m_96" class="t s1_96">Send the result </span>
<span id="t1n_96" class="t s1_96">of that to </span><span id="t1o_96" class="t s3_96">factorial</span><span id="t1p_96" class="t s1_96">, with a continuation that multiplies the smaller number’s factorial by my original input. </span>
<span id="t1q_96" class="t s1_96">Finally, call my continuation with the product.” </span><span id="t1r_96" class="t s1_96">You can use CPS to unwind even the most complicated </span>
<span id="t1s_96" class="t s1_96">branched recursions. </span>
<span id="t1t_96" class="t s1_96">By the way, I cheated a bit above. </span><span id="t1u_96" class="t s1_96">The </span><span id="t1v_96" class="t s3_96">if/else </span><span id="t1w_96" class="t s1_96">block should also use CPS; it should take one true/false input </span>
<span id="t1x_96" class="t s1_96">and </span><span id="t1y_96" class="t s2_96">two continuations. </span><span id="t1z_96" class="t s1_96">It will go to one or the other continuation depending on the value of its input. </span><span id="t20_96" class="t s1_96">But in fact </span>
<span id="t21_96" class="t s1_96">the C-shaped blocks (or E-shaped, like </span><span id="t22_96" class="t s3_96">if/else</span><span id="t23_96" class="t s1_96" data-mappings='[[30,"fi"]]'>) are really using CPS in the ﬁrst place, because they implicitly </span>
<span id="t24_96" class="t s1_96">wrap rings around the sub-scripts within their branches. </span><span id="t25_96" class="t s1_96">See if you can make an explicitly CPS </span><span id="t26_96" class="t s3_96">if/else </span><span id="t27_96" class="t s1_96">block. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
